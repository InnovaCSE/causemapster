CrÃ©e un projet web complet nommÃ© **CauseMapster**, structurÃ© pour analyser les accidents du travail via la mÃ©thode de lâ€™Arbre des Causes de lâ€™INRS.

### Objectifs :
- Interface en **franÃ§ais**
- Design professionnel : **gris clair et orange** dominants
- **Ergonomique et visuel**, avec **pictogrammes**, blocs bien sÃ©parÃ©s et **consignes simples**
- Fonctionnement en 4 Ã©tapes
- Connexion Ã  **Supabase** (authentification, base de donnÃ©es, stockage)
- IntÃ©gration de **ChatGPT via API** pour lâ€™analyse automatique
- Projet **modulaire et Ã©volutif vers un SaaS freemium/premium**

---

### Structure du projet :
- `/pages/` : index, login, register, formulaire1, formulaire2, formulaire3, arbre_des_causes
- `/components/` : header, footer, navbar, sidebar, bloc_formulaire, bouton_ia, tableau_faits, etc.
- `/services/` : supabaseClient.js, openaiClient.js, authService.js
- `/styles/` : style.css ou Tailwind intÃ©grÃ©
- `.env` pour clÃ© API OpenAI

---

### FonctionnalitÃ©s Ã  inclure :

#### ğŸ§­ Page dâ€™accueil (`index.html`)
- Nom de lâ€™app : **CauseMapster**
- Message de bienvenue
- Boutons :
  - ğŸ” Se connecter
  - âœï¸ Sâ€™inscrire
  - ğŸ†• Nouvelle analyse dâ€™accident

---

### ğŸ” Authentification (avec Supabase Auth)
- Page de **connexion** (email + mot de passe)
- Page de **crÃ©ation de compte**
- RÃ´les utilisateurs (utilisateur / admin)
- Stockage dans Supabase
- AccÃ¨s restreint aux pages dâ€™analyse si non connectÃ©
- Page "Mon compte" avec :
  - Email
  - Mot de passe modifiable
  - Liste des analyses enregistrÃ©es

---

### ğŸ“ Ã‰tape 1 â€“ **DÃ©claration d'accident du travail**
Formulaire avec blocs :
1. ğŸ“ **Informations gÃ©nÃ©rales**
   - NumÃ©ro automatique `ACC-AAAA-NNN`
   - Date (par dÃ©faut = aujourdâ€™hui)
   - Heure (auto)
   - Lieu de lâ€™accident
   - Ã‰tablissement concernÃ©
   - ğŸ“ Consigne : Â«â€¯ComplÃ©tez les informations gÃ©nÃ©rales sur lâ€™accident. Â»

2. ğŸ—‚ï¸ **Faits ultimes**
   - Ajout de plusieurs faits ultimes distincts
   - Description de lâ€™accident : champ texte **ou** enregistrement vocal (Web Speech API)
   - ğŸ“ Consigne : Â« DÃ©crivez les faits ultimes ou dictez-les Ã  voix haute. Â»

3. âš ï¸ **GravitÃ© perÃ§ue**
   - Options : mineur, modÃ©rÃ©, grave (boutons radio ou menu)
   - ğŸ“ Consigne : Â« SÃ©lectionnez le niveau de gravitÃ© tel que vous l'avez perÃ§u. Â»

4. ğŸ§â€â™‚ï¸ **DonnÃ©es victime**
   - Case Ã  cocher "Anonymiser"
   - Sinon : nom, prÃ©nom, fonction
   - ğŸ“ Consigne : Â« ComplÃ©tez les donnÃ©es si la victime est identifiÃ©e. Â»

5. ğŸ‘ï¸ **TÃ©moins**
   - Bouton "Ajouter un tÃ©moin"
   - Formulaire : nom, prÃ©nom, fonction
   - ğŸ“ Consigne : Â« Cliquez pour ajouter les tÃ©moins un par un. Â»

6. ğŸ§¾ **PiÃ¨ces jointes**
   - Bouton "Ajouter un fichier"
   - AperÃ§u des fichiers ajoutÃ©s
   - Stockage via **Supabase Storage**
   - ğŸ“ Consigne : Â« SÃ©lectionnez un ou plusieurs documents en lien avec lâ€™accident. Â»

âœ… Boutons en bas :
- ğŸ’¾ Enregistrer lâ€™accident
- â¡ï¸ Suivant : Analyser les tÃ©moignages
- â¬…ï¸ Retour Ã  la liste

---

### ğŸ“‹ Ã‰tape 2 â€“ **Analyse des tÃ©moins**

1. ğŸ§â€â™‚ï¸ **Partie 1 : victime**
   - Affiche les infos connues
   - Zone dâ€™enregistrement vocal ou texte libre
   - PossibilitÃ© de **sÃ©lectionner Ã  la souris** des fragments :
     - ğŸ“Œ Fait avÃ©rÃ©
     - ğŸ’¬ Opinion
     - â“ Ã‰lÃ©ment Ã  vÃ©rifier
   - GÃ©nÃ¨re des bulles (stockÃ©es dans Supabase)
   - âœ… Bouton : "ğŸ§  Lancer lâ€™analyse IA" (ChatGPT API â€“ GPT-4)

2. ğŸ‘¥ **Partie 2 : tÃ©moins**
   - Liste dÃ©roulante des tÃ©moins ajoutÃ©s
   - Pour chaque tÃ©moin, un bloc identique Ã  celui de la victime
   - Ajout possible de nouveaux tÃ©moins

3. ğŸ“Š **RÃ©capitulatif**
   - Tableau avec 4 colonnes :
     - Fait avÃ©rÃ©
     - Opinion
     - Ã‰lÃ©ment Ã  vÃ©rifier
     - Autre
   - Les bulles s'affichent dans la bonne colonne automatiquement

âœ… Boutons :
- ğŸ’¾ Enregistrer (brouillon)
- â¡ï¸ Suivant : Construire lâ€™arbre des causes
- ğŸ—‘ï¸ Supprimer cette analyse

---

### ğŸ§¾ Ã‰tape 3 â€“ **RÃ©sumÃ© de lâ€™accident analysÃ©**
- Tableau de tous les Ã©lÃ©ments analysÃ©s (modifiable)
- Colonne supplÃ©mentaire : âœ… Fait inhabituel ? (oui/non)
- Bouton pour **ajouter un fait manuel**

#### ğŸ“‚ **Bloc preuves matÃ©rielles**
- Tableau :
  - NumÃ©ro automatique
  - Description
  - UtilitÃ© pour lâ€™analyse ? (oui/non)
  - âœ… Validation de chaque ligne
  - PossibilitÃ© dâ€™ajouter des piÃ¨ces
  - âœ… Ajout auto dans Supabase Storage

âœ… Boutons :
- ğŸ’¾ Enregistrer en brouillon
- â¡ï¸ Suivant : Construire lâ€™arbre
- ğŸ—‘ï¸ Supprimer cette analyse

---

### ğŸŒ³ Ã‰tape 4 â€“ **Arbre des Causes**
- Arbre horizontal (droite â†’ gauche)
- Faits :
  - ğŸ”´ Faits nÃ©cessaires = cercle rouge
  - ğŸŸ  Faits inhabituels = cercle orange
  - ğŸŸ© Faits habituels = rectangle vert
- Liaisons :
  - ğŸ” EnchaÃ®nement
  - â• Conjonction
  - âŒ Disjonction
- ğŸ§  Bouton : "Analyser automatiquement lâ€™arbre des causes" (via GPT-4)
- Edition libre des liaisons et faits
- Tableau final avec faits nÃ©cessaires :
  - Peut-on supprimer ? â†’ mesure de prÃ©vention
  - Si non, peut-on rendre moins dangereux ? â†’ autre mesure
  - âœ… Aide IA activable pour chaque ligne

âœ… Boutons :
- ğŸ’¾ Enregistrer
- ğŸ“¤ Exporter en PDF
- ğŸ–¼ï¸ Exporter en image

---

### ğŸ“ PrÃ©paration SaaS
- Stocke le rÃ´le utilisateur
- Variable `plan_utilisateur` (gratuit/premium)
- Interface prÃªte pour ajout Stripe plus tard
- Limite : 3 analyses max si non premium
- Affichage dâ€™un message â€œfonctionnalitÃ© premiumâ€ si atteint

---

### ğŸ”— Connexion Supabase
- Tables Ã  crÃ©er :
  - utilisateurs, accidents, temoins, fragments, validations, preuves, sessions
- Stockage Supabase : fichiers (PDF, images)
- Auth Supabase pour login/register
- Appels API OpenAI via clÃ© privÃ©e sÃ©curisÃ©e (`process.env.OPENAI_API_KEY`)

---

### âœ… Design final
- Style propre, responsive
- Couleurs : orange + gris clair
- IcÃ´nes claires pour chaque action
- Formulaires modulaires et visuellement sÃ©parÃ©s
- Consignes simples dans chaque bloc

---

GÃ©nÃ¨re le projet complet avec fichiers HTML, JS, CSS, les composants rÃ©utilisables, et les connexions API/Supabase prÃªtes Ã  remplir.
